---
- name: Kubeadm | First Master | Create temporary local sync directory
  tempfile:
    state: directory
    suffix: sync
  register: temp_local_sync_dir
  delegate_to: localhost
  become: no
  run_once: yes

- name: Kubeadm | First Master | Copy Kubernetes files locally
  fetch:
    src: "{{ item }}"
    dest: "{{ temp_local_sync_dir.path }}/{{ item }}"
    flat: yes
  with_items:
    - /etc/kubernetes/pki/ca.crt
    - /etc/kubernetes/pki/ca.key
    - /etc/kubernetes/pki/sa.key
    - /etc/kubernetes/pki/sa.pub
    - /etc/kubernetes/pki/front-proxy-ca.crt
    - /etc/kubernetes/pki/front-proxy-ca.key
    - /etc/kubernetes/pki/etcd/ca.crt
    - /etc/kubernetes/pki/etcd/ca.key
  delegate_to: "{{ groups['master'] | first }}"
  run_once: yes